(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.JcWheelZoom=b())})(this,function(){'use strict';var k=Math.min;function a(a){var b=a.getBoundingClientRect(),c=document,d=c.body,e=c.documentElement,f=window.pageYOffset||e.scrollTop||d.scrollTop,g=window.pageXOffset||e.scrollLeft||d.scrollLeft,h=e.clientTop||d.clientTop||0,i=e.clientLeft||d.clientLeft||0,j=b.top+f-h,k=b.left+g-i;return{top:j,left:k}}function b(a,b){if(a&&b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function c(a,b,c){var d=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3];a.addEventListener(b,c,d)}function d(a,b,c){var d=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3];a.removeEventListener(b,c,d)}function e(a){var c=Math.abs;function b(a){for(var b=[],c=a.length-1;0<=c;c--)for(var d=0;d<a[c];d++)b.push((c+1)*h);return b}var d=24,e=2,f=[20,7,6,5,4],g=[],h=0<a?1:-1,j=2*c(a);j=j&&j>d?d:j,j=j&&j<e?e:j,a=j/2*h;for(var k=0;k<j-f.length;k++)g.push(2*a-k*h);return g.length?g.concat(b(f)):[]}function f(a){var d=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.dropHandler=this.dropHandler.bind(this),this.grabHandler=this.grabHandler.bind(this),this.moveHandler=this.moveHandler.bind(this),this.options=b({smoothExtinction:!1,onGrab:null,onMove:null,onDrop:null},e),this.isTouch="ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints,this.events=this.isTouch?{grab:"touchstart",move:"touchmove",drop:"touchend"}:{grab:"mousedown",move:"mousemove",drop:"mouseup"},this.events.options=!!this.isTouch&&{passive:!0},this.scrollable=a,c(this.scrollable,this.events.grab,function(a){(d.isTouch&&1===a.touches.length||1===a.buttons)&&d.grabHandler(a)},this.events.options)}function g(a,b){!this.isGrab&&b.length&&(this.scrollable[a]-=b.shift(),b.length&&window.requestAnimationFrame(g.bind(this,a,b)))}function h(a){return"wheel"===a.type?a.clientX:a.changedTouches[0].clientX}function i(a){return"wheel"===a.type?a.clientY:a.changedTouches[0].clientY}function j(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this._init=this._init.bind(this),this._prepare=this._prepare.bind(this),this._rescale=this._rescale.bind(this);this.image=document.querySelector(a),this.options=b({dragScrollable:!0,dragScrollableOptions:{},maxScale:1,speed:10},c),null!==this.image&&(this.window=this.image.parentNode,this.image.complete?this._init():this.image.onload=this._init)}return f.prototype={constructor:f,isTouch:!1,isGrab:!1,events:null,scrollable:null,moveTimer:null,options:{},coordinates:null,speed:null,grabHandler:function(a){this.isTouch||a.preventDefault(),this.isGrab=!0,this.coordinates={left:h(a),top:i(a)},this.speed={x:0,y:0},c(document,this.events.drop,this.dropHandler,this.events.options),c(document,this.events.move,this.moveHandler,this.events.options),"function"==typeof this.options.onGrab&&this.options.onGrab()},dropHandler:function(a){this.isTouch||a.preventDefault(),this.isGrab=!1,this.options.smoothExtinction&&(g.call(this,"scrollLeft",e(this.speed.x)),g.call(this,"scrollTop",e(this.speed.y))),d(document,this.events.drop,this.dropHandler),d(document,this.events.move,this.moveHandler),"function"==typeof this.options.onDrop&&this.options.onDrop()},moveHandler:function(a){this.isTouch||a.preventDefault(),this.speed.x=h(a)-this.coordinates.left,this.speed.y=i(a)-this.coordinates.top,clearTimeout(this.moveTimer),this.moveTimer=setTimeout(function(){this.speed={x:0,y:0}}.bind(this),50),this.scrollable.scrollLeft-=this.speed.x,this.scrollable.scrollTop-=this.speed.y,this.coordinates={left:h(a),top:i(a)},"function"==typeof this.options.onMove&&this.options.onMove()}},j.prototype={constructor:j,image:null,container:null,window:null,original:{image:{},window:{}},options:null,correctX:null,correctY:null,_init:function(){this.original.image={width:this.image.offsetWidth,height:this.image.offsetHeight},this.container=document.createElement("div"),this.window.appendChild(this.container),this.container.appendChild(this.image),this._prepare(),!0===this.options.dragScrollable&&new f(this.window,this.options.dragScrollableOptions),c(this.window,"wheel",this._rescale),c(window,"resize",this._rescale)},_prepare:function(){var a=Math.max;this.original.window={width:this.window.offsetWidth,height:this.window.offsetHeight};var b=k(this.original.window.width/this.original.image.width,this.original.window.height/this.original.image.height);this.correctX=a(0,(this.original.window.width-this.original.image.width*b)/2),this.correctY=a(0,(this.original.window.height-this.original.image.height*b)/2),this.image.width=this.original.image.width*b,this.image.height=this.original.image.height*b,this.image.style.marginLeft="".concat(this.correctX,"px"),this.image.style.marginTop="".concat(this.correctY,"px"),this.container.style.width="".concat(this.image.width+2*this.correctX,"px"),this.container.style.height="".concat(this.image.height+2*this.correctY,"px"),"function"==typeof this.options.prepare&&this.options.prepare(b,this.correctX,this.correctY)},_rescale:function(b){var c=Math.round;b.preventDefault();var d=0>b.deltaY?1:-1,e=this.image.width,f=this.image.height,g=e/this.original.image.width,h=k(this.original.window.width/this.original.image.width,this.original.window.height/this.original.image.height),i=g+d/this.options.speed;i=i<h?h:i>this.options.maxScale?this.options.maxScale:i;var j=this.window.scrollLeft,l=this.window.scrollTop,m=this.image.width=this.original.image.width*i,n=this.image.height=this.original.image.height*i,o=m+2*this.correctX,p=n+2*this.correctY;this.container.style.width="".concat(o,"px"),this.container.style.height="".concat(p,"px"),"function"==typeof this.options.rescale&&this.options.rescale(i,this.correctX,this.correctY,h);var q=this.window.scrollLeft,r=this.window.scrollTop,s=a(this.window),t=c(b.pageX-s.left+this.window.scrollLeft-this.correctX),u=c(m*t/e);this.window.scrollLeft+=u-t+(j-q);var v=c(b.pageY-s.top+this.window.scrollTop-this.correctY),w=c(n*v/f);this.window.scrollTop+=w-v+(l-r)},prepare:function(){this._prepare()},zoomUp:function(){var b=a(this.window),c=new Event("wheel");c.deltaY=-1,c.pageX=b.left+this.original.window.width/2,c.pageY=b.top+this.original.window.height/2,this._rescale(c)},zoomDown:function(){var b=a(this.window),c=new Event("wheel");c.deltaY=1,c.pageX=b.left+this.original.window.width/2,c.pageY=b.top+this.original.window.height/2,this._rescale(c)}},j.create=function(a,b){return new j(a,b)},j});