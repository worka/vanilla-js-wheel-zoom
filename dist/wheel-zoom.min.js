!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).WZoom=e()}(this,function(){"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}function e(t,e,n){return e=a(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,u()?Reflect.construct(e,[],a(t).constructor):e.apply(t,n))}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,m(o.key),o)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=v(t))||e){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw r}}}}function r(t,e,n){return(e=m(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(){return s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var o=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=a(t)););return t}(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},s.apply(null,arguments)}function a(t){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},a(t)}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&f(t,e)}function u(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(u=function(){return!!t})()}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach(function(e){r(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(t,e)}function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,i,r,s,a=[],c=!0,u=!1;try{if(r=(n=n.call(t)).next,0===e);else for(;!(c=(o=r.call(n)).done)&&(a.push(o.value),a.length!==e);c=!0);}catch(t){u=!0,i=t}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw i}}return a}}(t,e)||v(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e,n,o){var i=s(a(t.prototype),e,n);return"function"==typeof i?function(t){return i.apply(n,t)}:i}function m(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e);if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function v(e,n){if(e){if("string"==typeof e)return t(e,n);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?t(e,n):void 0}}function g(t){var e=t.getBoundingClientRect(),n=document,o=n.body,i=n.documentElement,r=b(),s=y(),a=i.clientTop||o.clientTop||0,c=i.clientLeft||o.clientLeft||0;return{top:e.top+r-a,left:e.left+s-c}}function y(){var t=void 0!==window.pageXOffset,e="CSS1Compat"===(document.compatMode||"");return t?window.pageXOffset:e?document.documentElement.scrollLeft:document.body.scrollLeft}function b(){var t=void 0!==window.pageYOffset,e="CSS1Compat"===(document.compatMode||"");return t?window.pageYOffset:e?document.documentElement.scrollTop:document.body.scrollTop}function _(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.addEventListener(e,n,o)}function w(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.removeEventListener(e,n,o)}function H(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}function T(t){return"wheel"===t.type||"pointerup"===t.type||"pointerdown"===t.type||"pointermove"===t.type||"mousedown"===t.type||"mousemove"===t.type||"mouseup"===t.type?t.clientX:t.changedTouches[0].clientX}function S(t){return"wheel"===t.type||"pointerup"===t.type||"pointerdown"===t.type||"pointermove"===t.type||"mousedown"===t.type||"mousemove"===t.type||"mouseup"===t.type?t.clientY:t.changedTouches[0].clientY}function O(t){P(t,"translate",null),P(t,"scale",null)}function P(t,e,n){var o=t.style,i=o.transition,r=RegExp(e+"[^,]+","i");if(null!==n){var s="".concat(e," ").concat(n,"s");i?i.includes(e)?o.transition=i.replace(r,s):o.transition+=", ".concat(s):o.transition=s}else i.includes(e)&&(o.transition=i.replace(RegExp(r.source+",?"),"")),o.transition||o.removeProperty("transition")}function x(t,e,n,o,i,r){var s=i/2-(t+e-n)+o;return s*r-s+o}function k(t,e,n,o,i){switch(t){case"left":o/2-i<e/2&&(i=(o-e)/2);break;case"right":o/2+i<e/2&&(i=(o-e)/2*-1);break;default:if((o-e)/2+n<Math.abs(i))i=((o-e)/2+n)*(i<0?-1:1)}return i}var D={type:"image",width:null,height:null,minScale:null,maxScale:1,speed:1.1,zoomOnClick:!0,zoomOnDblClick:!1,smoothTime:.25,alignContent:"center",disableWheelZoom:!1,reverseWheelDirection:!1,dragScrollable:!0},W=function(){return o(function t(){n(this,t),this.subscribes={}},[{key:"on",value:function(t,e){return t in this.subscribes||(this.subscribes[t]=[]),this.subscribes[t].push(e),this}},{key:"destroy",value:function(){for(var t in this)this.hasOwnProperty(t)&&(this[t]=null)}},{key:"_run",value:function(t,e){if(this.subscribes[t]){var n,o=i(this.subscribes[t]);try{for(o.s();!(n=o.n()).done;){(0,n.value)(e)}}catch(t){o.e(t)}finally{o.f()}}}}])}(),j="grab",M="move",E="drop",$=function(t){function i(t){var o;return n(this,i),(o=e(this,i)).target=t,o.moveTimer=null,o.coordinates=null,o.coordinatesShift=null,o.isTouch=H(),o.events=o.isTouch?{grab:"touchstart",move:"touchmove",drop:"touchend"}:{grab:"mousedown",move:"mousemove",drop:"mouseup"},o.events.options=!!o.isTouch&&{passive:!1},o._dropHandler=o._dropHandler.bind(o),o._grabHandler=o._grabHandler.bind(o),o._moveHandler=o._moveHandler.bind(o),_(o.target,o.events.grab,o._grabHandler,o.events.options),o}return c(i,t),o(i,[{key:"destroy",value:function(){w(this.target,this.events.grab,this._grabHandler,this.events.options),w(document,this.events.drop,this._dropHandler),w(document,this.events.move,this._moveHandler),d(i,"destroy",this)([])}},{key:"_grabHandler",value:function(t){(this.isTouch&&1===t.touches.length||1===t.buttons)&&(this.coordinates={x:T(t),y:S(t)},this.coordinatesShift={x:0,y:0},_(document,this.events.drop,this._dropHandler,this.events.options),_(document,this.events.move,this._moveHandler,this.events.options),this._run(j,t))}},{key:"_dropHandler",value:function(t){w(document,this.events.drop,this._dropHandler),w(document,this.events.move,this._moveHandler),this._run(E,t)}},{key:"_moveHandler",value:function(t){if(this.isTouch&&t.touches.length>1)return!1;var e=this.coordinatesShift,n=this.coordinates;e.x=T(t)-n.x,e.y=S(t)-n.y,n.x=T(t),n.y=S(t),clearTimeout(this.moveTimer),this.moveTimer=setTimeout(function(){e.x=0,e.y=0},50),t.data=h(h({},t.data||{}),{},{x:e.x,y:e.y}),this._run(M,t)}}])}(W),z="click",C="dblclick",L="wheel",Y=function(t){function i(t){var o;return n(this,i),(o=e(this,i)).target=t,o.coordsOnDown=null,o.pressingTimeout=null,o.firstClick=!0,o.isTouch=H(),o.events=o.isTouch?{down:"touchstart",up:"touchend"}:{down:"mousedown",up:"mouseup"},o.events.options=!!o.isTouch&&{passive:!0},o._downHandler=o._downHandler.bind(o),o._upHandler=o._upHandler.bind(o),o._wheelHandler=o._wheelHandler.bind(o),_(o.target,o.events.down,o._downHandler,o.events.options),_(o.target,o.events.up,o._upHandler,o.events.options),_(o.target,L,o._wheelHandler),o}return c(i,t),o(i,[{key:"destroy",value:function(){w(this.target,this.events.down,this._downHandler,this.events.options),w(this.target,this.events.up,this._upHandler,this.events.options),w(this.target,L,this._wheelHandler,this.events.options),d(i,"destroy",this)([])}},{key:"_downHandler",value:function(t){this.coordsOnDown=null,(this.isTouch&&1===t.touches.length||1===t.buttons)&&(this.coordsOnDown={x:T(t),y:S(t)}),clearTimeout(this.pressingTimeout)}},{key:"_upHandler",value:function(t){var e=this,n=this.subscribes[C]?setTimeout:function(t,e){return t()};this.firstClick?(this.firstClick=!1,this.pressingTimeout=n(function(){e._isDetectedShift(t)||e._run(z,t),e.firstClick=!0},200)):this.pressingTimeout=n(function(){e._isDetectedShift(t)||e._run(C,t),e.firstClick=!0},100)}},{key:"_wheelHandler",value:function(t){this._run(L,t)}},{key:"_isDetectedShift",value:function(t){return!(this.coordsOnDown&&this.coordsOnDown.x===T(t)&&this.coordsOnDown.y===S(t))}}])}(W),X="pinchtozoom",Z=function(t){function i(t){var o;return n(this,i),(o=e(this,i)).target=t,o.fingersHypot=null,o.zoomPinchWasDetected=!1,o._touchMoveHandler=o._touchMoveHandler.bind(o),o._touchEndHandler=o._touchEndHandler.bind(o),_(o.target,"touchmove",o._touchMoveHandler),_(o.target,"touchend",o._touchEndHandler),o}return c(i,t),o(i,[{key:"destroy",value:function(){w(this.target,"touchmove",this._touchMoveHandler),w(this.target,"touchend",this._touchEndHandler),d(i,"destroy",this)([])}},{key:"_touchMoveHandler",value:function(t){if(2===t.targetTouches.length){var e=t.targetTouches[0].clientX,n=t.targetTouches[0].clientY,o=t.targetTouches[1].clientX,i=t.targetTouches[1].clientY,r=Math.round(Math.sqrt(Math.pow(Math.abs(e-o),2)+Math.pow(Math.abs(n-i),2))),s=0;if(r>this.fingersHypot+5&&(s=-1),r<this.fingersHypot-5&&(s=1),0!==s){if(null!==this.fingersHypot||1===s){var a=Math.min(e,o)+Math.abs(e-o)/2,c=Math.min(n,i)+Math.abs(n-i)/2;t.data=h(h({},t.data||{}),{},{clientX:a,clientY:c,direction:s}),this._run(X,t)}this.fingersHypot=r,this.zoomPinchWasDetected=!0}}}},{key:"_touchEndHandler",value:function(){this.zoomPinchWasDetected&&(this.fingersHypot=null,this.zoomPinchWasDetected=!1)}}])}(W);function R(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._init=this._init.bind(this),this._prepare=this._prepare.bind(this),this._computeScale=this._computeScale.bind(this),this._computePosition=this._computePosition.bind(this),this._transform=this._transform.bind(this),this.content={},"string"==typeof t){if(this.content.$element=document.querySelector(t),!this.content.$element)throw"WZoom: Element with selector `".concat(t,"` not found")}else{if(!(t instanceof HTMLElement))throw"WZoom: `selectorOrHTMLElement` must be selector or HTMLElement, and not ".concat({}.toString.call(t));this.content.$element=t}this.viewport={},this.viewport.$element=this.content.$element.parentElement,this.options=function(t,e){var n=Object.assign({},e,t);if(H())n.smoothTime=0,n.smoothTimeDrag=0;else{var o=Number(n.smoothTime),i=Number(n.smoothTimeDrag);n.smoothTime=isNaN(o)?D.smoothTime:o,n.smoothTimeDrag=isNaN(i)?n.smoothTime:i}return n}(e,D),this.isTouch=H(),this.direction=1,this.observers=[],"image"===this.options.type?this.content.$element.complete?this._init():_(this.content.$element,"load",this._init,{once:!0}):this._init()}return R.prototype={constructor:R,_init:function(){var t=this,e=this.viewport,n=this.content,o=this.options,i=this.observers;if(this._prepare(),this._destroyObservers(),!0===o.dragScrollable){var r=new $(n.$element);i.push(r),"function"==typeof o.onGrab&&r.on(j,function(e){e.preventDefault(),o.onGrab(e,t)}),"function"==typeof o.onDrop&&r.on(E,function(e){e.preventDefault(),o.onDrop(e,t)}),r.on(M,function(i){i.preventDefault();var r=i.data,s=r.x,a=r.y,c=n.currentLeft+s,u=n.currentTop+a,l=(n.currentWidth-e.originalWidth)/2+n.correctX,h=(n.currentHeight-e.originalHeight)/2+n.correctY;Math.abs(c)<=l&&(n.currentLeft=c),Math.abs(u)<=h&&(n.currentTop=u),t._transform(o.smoothTimeDrag),"function"==typeof o.onMove&&o.onMove(i,t)})}var s=new Y(n.$element);if(i.push(s),!o.disableWheelZoom)if(this.isTouch){var a=new Z(n.$element);i.push(a),a.on(X,function(e){var n=e.data,o=n.clientX,i=n.clientY,r=n.direction,s=t._computeScale(r);t._computePosition(s,o,i),t._transform()})}else s.on(L,function(e){e.preventDefault();var n=o.reverseWheelDirection?-e.deltaY:e.deltaY,i=t._computeScale(n);t._computePosition(i,T(e),S(e)),t._transform()});if(o.zoomOnClick||o.zoomOnDblClick){var c=o.zoomOnDblClick?C:z;s.on(c,function(e){var o=1===t.direction?n.maxScale:n.minScale;t._computePosition(o,T(e),S(e)),t._transform(),t.direction*=-1})}},_prepare:function(){var t,e=this.viewport,n=this.content,o=this.options,i=g(e.$element),r=i.left,s=i.top;e.originalWidth=e.$element.offsetWidth,e.originalHeight=e.$element.offsetHeight,e.originalLeft=r,e.originalTop=s,"image"===o.type?(n.originalWidth=o.width||n.$element.naturalWidth,n.originalHeight=o.height||n.$element.naturalHeight):(n.originalWidth=o.width||n.$element.offsetWidth,n.originalHeight=o.height||n.$element.offsetHeight);var a=n.$element.style.scale.split(" ").map(parseFloat);n.originalScale=function(){if(a.some(isNaN))return[1,1,1];switch(a.length){case 1:return[a[0],a[0],1];case 2:return[a[0],a[1],1];case 3:return a}}(),n.originalTranslateZ=(null===(t=n.$element.style.translate)||void 0===t?void 0:t.split(" ")[2])||"0px",n.maxScale=o.maxScale,n.minScale=o.minScale||Math.min(e.originalWidth/n.originalWidth,e.originalHeight/n.originalHeight,n.maxScale),n.currentScale=n.minScale,n.currentWidth=n.originalWidth*n.currentScale,n.currentHeight=n.originalHeight*n.currentScale;var c=function(t,e,n){var o=0,i=0;switch(n){case"top":i=(e.currentHeight-t.originalHeight)/2;break;case"right":o=(e.currentWidth-t.originalWidth)/2*-1;break;case"bottom":i=(e.currentHeight-t.originalHeight)/2*-1;break;case"left":o=(e.currentWidth-t.originalWidth)/2}return[o,i]}(e,n,o.alignContent),u=p(c,2);n.alignPointX=u[0],n.alignPointY=u[1],n.currentLeft=n.alignPointX,n.currentTop=n.alignPointY;var l=function(t,e,n){var o=Math.max(0,(t.originalWidth-e.currentWidth)/2),i=Math.max(0,(t.originalHeight-e.currentHeight)/2);switch(n){case"top":i=0;break;case"right":o=0;break;case"bottom":i*=2;break;case"left":o*=2}return[o,i]}(e,n,o.alignContent),h=p(l,2);n.correctX=h[0],n.correctY=h[1],"function"==typeof o.prepare&&o.prepare(this),this._transform()},_computeScale:function(t){this.direction=t<0?1:-1;var e=this.content,n=e.minScale,o=e.maxScale,i=e.currentScale*Math.pow(this.options.speed,this.direction);return i<=n?(this.direction=1,n):i>=o?(this.direction=-1,o):i},_computePosition:function(t,e,n){var o=this.viewport,i=this.content,r=this.options,s=this.direction,a=i.originalWidth*t,c=i.originalHeight*t,u=y(),l=b(),h=x(e,u,o.originalLeft,i.currentLeft,o.originalWidth,a/i.currentWidth),f=x(n,l,o.originalTop,i.currentTop,o.originalHeight,c/i.currentHeight);-1===s&&(h=k(r.alignContent,o.originalWidth,i.correctX,a,h),f=k(r.alignContent,o.originalHeight,i.correctY,c,f)),t===i.minScale&&(h=i.alignPointX,f=i.alignPointY),i.currentWidth=a,i.currentHeight=c,i.currentLeft=h,i.currentTop=f,i.currentScale=t},_transform:function(t){void 0===t&&(t=this.options.smoothTime);var e=this.content,n=e.$element,o=e.originalScale,i=e.currentScale,r=e.currentLeft,s=e.currentTop,a=e.originalTranslateZ,c="".concat(o[0]*i," ").concat(o[1]*i," ").concat(o[2]);!function(t,e){e?(P(t,"translate",e),P(t,"scale",e)):O(t)}(n,t),function(t,e,n,o,i){t.style.translate="".concat(e,"px ").concat(n,"px ").concat(o),t.style.scale=i}(n,r,s,a,c),"function"==typeof this.options.rescale&&this.options.rescale(this)},_zoom:function(t){var e,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};void 0!==o.x&&void 0!==o.y||(e=this.viewport,o={x:(n=g(e.$element)).left+e.originalWidth/2-y(),y:n.top+e.originalHeight/2-b()}),this._computePosition(t,o.x,o.y),this._transform()},_destroyObservers:function(){var t,e=i(this.observers);try{for(e.s();!(t=e.n()).done;){t.value.destroy()}}catch(t){e.e(t)}finally{e.f()}},prepare:function(){this.restoreElement(),this._prepare()},transform:function(t,e,n){var o=this.content;o.currentWidth=o.originalWidth*n,o.currentHeight=o.originalHeight*n,o.currentLeft=e,o.currentTop=t,o.currentScale=n,this._transform()},zoomUp:function(){this._zoom(this._computeScale(-1))},zoomDown:function(){this._zoom(this._computeScale(1))},maxZoomUp:function(){this._zoom(this.content.maxScale)},maxZoomDown:function(){this._zoom(this.content.minScale)},zoomUpToPoint:function(t){this._zoom(this._computeScale(-1),t)},zoomDownToPoint:function(t){this._zoom(this._computeScale(1),t)},maxZoomUpToPoint:function(t){this._zoom(this.content.maxScale,t)},restoreElement:function(){var t=this.content,e=t.$element,n=t.originalScale,o=t.originalTranslateZ;n.every(function(t){return 1===t})?e.style.removeProperty("scale"):e.style.scale="".concat(n[0]," ").concat(n[1]," ").concat(n[2]),"0px"===o?e.style.removeProperty("translate"):e.style.translate="0 0 "+o},destroy:function(){var t=this.content.$element;for(var e in this.restoreElement(),O(t),"image"===this.options.type&&w(t,"load",this._init),this._destroyObservers(),this)this.hasOwnProperty(e)&&(this[e]=null)}},R.create=function(t){return new R(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})},R});